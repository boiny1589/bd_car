# AI巡线系统运行指南

## 系统概述

这是一个完整的智能小车AI巡线系统，包含以下功能：
- 小车基础移动控制
- 摄像头图像获取
- 车道线检测算法
- PID控制器
- 实时可视化

## 运行步骤

### 第一步：环境准备

1. **检查Python环境**
   ```bash
   python --version  # 建议Python 3.7+
   ```

2. **安装依赖包**
   ```bash
   pip install numpy opencv-python pyyaml simple-pid
   ```

3. **检查硬件连接**
   - 确保小车电机已连接
   - 确保摄像头已连接（设备号1）
   - 确保电源充足

### 第二步：基础功能测试

1. **测试小车基础移动**
   ```bash
   python basic_car_test.py
   ```
   这个程序会测试：
   - 小车前进、后退
   - 小车左转、右转
   - 里程计功能

2. **测试摄像头功能**
   ```bash
   python camera_test.py
   ```
   这个程序会测试：
   - 摄像头图像获取
   - 双摄像头功能
   - 摄像头参数设置

### 第三步：车道线检测测试

1. **测试车道线检测算法**
   ```bash
   python simple_lane_detection.py
   ```
   这个程序会测试：
   - 传统图像处理方法
   - 车道线中心检测
   - 可视化显示

### 第四步：完整AI巡线系统

1. **运行完整AI巡线系统**
   ```bash
   python ai_lane_following.py
   ```
   这个程序会：
   - 初始化小车和摄像头
   - 实时检测车道线
   - 使用PID控制器进行巡线
   - 显示实时可视化结果

## 系统参数调整

### PID参数调整

在 `ai_lane_following.py` 中可以调整PID参数：

```python
# 当前参数
self.pid_x = PID(Kp=0.001, Ki=0.0, Kd=0.0, setpoint=0)

# 建议调整范围
# Kp: 0.0005 - 0.002 (比例系数)
# Ki: 0.0 - 0.0001 (积分系数)
# Kd: 0.0 - 0.0005 (微分系数)
```

### 速度参数调整

```python
# 当前参数
self.base_speed = 0.2  # 基础速度
self.max_speed = 0.4   # 最大速度
self.min_speed = 0.1   # 最小速度
```

### 车道线检测参数调整

```python
# 当前参数
self.center_x = 320  # 图像中心x坐标
self.center_y = 480  # 图像中心y坐标
```

## 故障排除

### 常见问题

1. **小车不移动**
   - 检查电机连接
   - 检查电源电压
   - 检查串口连接

2. **摄像头无法获取图像**
   - 检查摄像头设备号（默认1）
   - 检查摄像头连接
   - 检查摄像头驱动

3. **车道线检测不准确**
   - 调整图像预处理参数
   - 调整ROI区域
   - 调整颜色阈值

4. **巡线效果不好**
   - 调整PID参数
   - 调整速度参数
   - 检查车道线质量

### 调试技巧

1. **查看实时图像**
   - 程序运行时会显示摄像头图像
   - 按 'q' 键退出

2. **查看控制信息**
   - 控制台会打印偏移量和速度信息
   - 观察PID控制效果

3. **保存调试图像**
   ```python
   # 在代码中添加
   cv2.imwrite('debug_image.jpg', frame)
   ```

## 高级功能

### 使用原始系统的完整功能

如果您想使用原始的完整系统，可以运行：

```bash
python car_start.py
```

这个系统包含：
- 完整的MyCar类
- 多种巡线模式
- 任务执行功能
- 菜单式界面

### 配置文件调整

编辑 `config_car.yml` 文件来调整系统参数：

```yaml
# 摄像头配置
camera:
  front: 1  # 前摄像头设备号
  side: 2   # 侧摄像头设备号

# PID控制器参数
lane_pid:
  cfg_pid_y:
    Kp: 4      # 比例系数
    Ki: 0      # 积分系数
    Kd: 0      # 微分系数
```

## 安全注意事项

1. **测试环境**
   - 在安全的测试环境中运行
   - 确保周围没有障碍物
   - 准备紧急停止按钮

2. **速度控制**
   - 开始时使用较低速度
   - 逐步调整到合适速度
   - 避免突然的速度变化

3. **监控运行**
   - 始终监控小车运行状态
   - 准备手动干预
   - 记录运行日志

## 下一步发展

1. **改进车道线检测**
   - 使用深度学习模型
   - 改进图像预处理
   - 增加多种车道线类型

2. **增加传感器**
   - 添加超声波传感器
   - 添加红外传感器
   - 实现避障功能

3. **优化控制算法**
   - 使用更高级的PID控制
   - 实现自适应控制
   - 增加路径规划

4. **扩展功能**
   - 添加目标检测
   - 实现自主导航
   - 增加任务执行能力 